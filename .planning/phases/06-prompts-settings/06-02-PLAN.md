---
phase: 06-prompts-settings
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - entrypoints/popup/main.tsx
  - entrypoints/popup/App.tsx
  - src/components/settings/ApiKeySettings.tsx
  - src/components/settings/ModelSettings.tsx
  - src/components/settings/HotkeySettings.tsx
  - src/components/settings/BlurSettings.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter and save ElevenLabs API key"
    - "User can enter and save OpenRouter API key"
    - "User can select fast model from dropdown"
    - "User can select full model from dropdown"
    - "User can change capture hotkey binding"
    - "User can adjust blur level with slider"
    - "Settings persist after closing and reopening popup"
  artifacts:
    - path: "src/components/settings/ApiKeySettings.tsx"
      provides: "API key input fields with show/hide toggle"
      min_lines: 40
    - path: "src/components/settings/ModelSettings.tsx"
      provides: "Model selection dropdowns for fast and full models"
      min_lines: 30
    - path: "src/components/settings/HotkeySettings.tsx"
      provides: "Hotkey customization input"
      min_lines: 25
    - path: "src/components/settings/BlurSettings.tsx"
      provides: "Blur level slider with preview"
      min_lines: 20
    - path: "entrypoints/popup/App.tsx"
      provides: "Settings panel UI with tabbed navigation"
      min_lines: 60
  key_links:
    - from: "entrypoints/popup/main.tsx"
      to: "src/store/index.ts"
      via: "storeReadyPromise await before render"
      pattern: "storeReadyPromise.*then"
    - from: "src/components/settings/ApiKeySettings.tsx"
      to: "src/store/index.ts"
      via: "useStore hook"
      pattern: "useStore.*setApiKey"
---

<objective>
Create the Settings UI components for API keys, model selection, hotkey configuration, and blur level adjustment.

Purpose: Allow users to configure all extension settings through the popup interface. These settings will be consumed by the pipeline in Phase 7.

Output: Complete settings panel in popup with all configuration options functional and persisting to storage.
</objective>

<execution_context>
@/Users/sasha-marchuk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sasha-marchuk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-prompts-settings/06-RESEARCH.md

# Prior plan output
@.planning/phases/06-prompts-settings/06-01-SUMMARY.md

# Store (from Plan 01)
@src/store/index.ts
@src/store/types.ts

# Existing popup
@entrypoints/popup/main.tsx
@entrypoints/popup/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update popup entry to await store ready</name>
  <files>
    entrypoints/popup/main.tsx
  </files>
  <action>
Update `entrypoints/popup/main.tsx` to await storeReadyPromise before rendering:

1. Import storeReadyPromise from the store:
   ```typescript
   import { storeReadyPromise } from '../../src/store';
   ```

2. Wrap the ReactDOM.createRoot call in storeReadyPromise.then():
   - This ensures the store is hydrated from chrome.storage before rendering
   - Prevents UI "flash" of default values

3. Keep the existing React.StrictMode wrapper

4. Add a simple loading indicator while waiting:
   - Show a minimal "Loading..." text in the root div before store is ready
   - Use document.getElementById('root')!.innerHTML = '...' before the promise

This prevents the hydration race condition mentioned in RESEARCH.md.
  </action>
  <verify>
    - File imports storeReadyPromise
    - ReactDOM.createRoot is inside .then() callback
    - Run `npx tsc --noEmit` passes
  </verify>
  <done>
    Popup entry point waits for store hydration before rendering React app.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create settings components</name>
  <files>
    src/components/settings/ApiKeySettings.tsx
    src/components/settings/ModelSettings.tsx
    src/components/settings/HotkeySettings.tsx
    src/components/settings/BlurSettings.tsx
  </files>
  <action>
Create settings directory and components:

1. Create `src/components/settings/ApiKeySettings.tsx`:
   - Import useStore from store
   - Render two input fields: ElevenLabs and OpenRouter API keys
   - Use type="password" by default with show/hide toggle button
   - Track showKey state: Record<string, boolean>
   - On change, call setApiKey(provider, value)
   - Style with Tailwind: labels, inputs with border, rounded corners
   - Include placeholder text like "Enter your ElevenLabs API key"

2. Create `src/components/settings/ModelSettings.tsx`:
   - Import useStore from store
   - Create FAST_MODELS and FULL_MODELS arrays with popular OpenRouter models:
     - Fast: google/gemini-flash-1.5, anthropic/claude-3-haiku, openai/gpt-4o-mini
     - Full: anthropic/claude-3-5-sonnet, openai/gpt-4o, google/gemini-pro-1.5
   - Render two select dropdowns: "Fast Model (hints)" and "Full Model (answers)"
   - On change, call setModel(type, value)
   - Show current selection from store
   - Style: label + select with Tailwind

3. Create `src/components/settings/HotkeySettings.tsx`:
   - Import useStore from store
   - Render input field showing current hotkey binding
   - Add note: "Use format like Ctrl+Shift+Space"
   - On change, call setHotkey('capture', value)
   - Style: label + input + helper text

4. Create `src/components/settings/BlurSettings.tsx`:
   - Import useStore from store
   - Render range input (slider) for blur level 0-20
   - Show current value next to slider
   - On change, call setBlurLevel(Number(value))
   - Style: label + range input + value display
  </action>
  <verify>
    - All four component files exist in src/components/settings/
    - Each imports useStore from '../../store'
    - Run `npx tsc --noEmit` passes
  </verify>
  <done>
    All four settings components created with proper store integration and Tailwind styling.
  </done>
</task>

<task type="auto">
  <name>Task 3: Rebuild popup App with settings panel</name>
  <files>
    entrypoints/popup/App.tsx
  </files>
  <action>
Rebuild `entrypoints/popup/App.tsx` to show a proper settings panel:

1. Replace the Phase 1 test UI with a settings-focused layout

2. Create a simple tabbed interface with two tabs:
   - "Settings" tab (default)
   - "Templates" tab (placeholder for Plan 03)

3. Settings tab content:
   - Section heading: "API Keys"
   - ApiKeySettings component
   - Section heading: "Models"
   - ModelSettings component
   - Section heading: "Hotkeys"
   - HotkeySettings component
   - Section heading: "Appearance"
   - BlurSettings component

4. Templates tab content:
   - Placeholder text: "Template management coming soon"
   - (Will be replaced in Plan 03)

5. Keep the version footer

6. Layout:
   - Width: w-96 (wider than before for settings)
   - Max height with scroll: max-h-[500px] overflow-y-auto
   - Padding and spacing with Tailwind
   - Tab buttons styled with active state indicator

7. Import all settings components from relative paths:
   ```typescript
   import ApiKeySettings from '../../src/components/settings/ApiKeySettings';
   ```
  </action>
  <verify>
    - App.tsx imports all four settings components
    - Tab navigation renders both tabs
    - Settings tab shows all four settings sections
    - Run `npx tsc --noEmit` passes
    - Run `npm run build` succeeds
  </verify>
  <done>
    Popup App rebuilt as settings panel with tabbed navigation, all settings components integrated.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Type check passes:
   ```bash
   npx tsc --noEmit
   ```

2. Build succeeds:
   ```bash
   npm run build
   ```

3. Manual test in browser:
   - Load extension via chrome://extensions
   - Click extension icon to open popup
   - Settings tab shows:
     - Two API key inputs with show/hide toggles
     - Two model dropdowns with options
     - Hotkey input field
     - Blur level slider
   - Enter an API key, close popup, reopen - key should persist
   - Change model selection - should persist
   - Adjust blur slider - should persist

4. Console shows no errors
</verification>

<success_criteria>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Popup shows tabbed interface with Settings and Templates tabs
4. All four settings sections visible and functional
5. API key inputs have show/hide toggle
6. Model dropdowns have multiple options
7. Settings persist after closing and reopening popup
8. No console errors when interacting with settings
</success_criteria>

<output>
After completion, create `.planning/phases/06-prompts-settings/06-02-SUMMARY.md`
</output>
