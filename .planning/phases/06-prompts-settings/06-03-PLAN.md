---
phase: 06-prompts-settings
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/templates/TemplateList.tsx
  - src/components/templates/TemplateEditor.tsx
  - src/components/templates/TemplateManager.tsx
autonomous: true

must_haves:
  truths:
    - "User sees list of prompt templates (System Design, Coding, Behavioral)"
    - "User can select a template to make it active"
    - "User can view and edit template content"
    - "User can create new custom templates"
    - "User can delete custom templates (not defaults)"
    - "User can set per-template model override"
    - "Templates persist across sessions"
  artifacts:
    - path: "src/components/templates/TemplateList.tsx"
      provides: "Clickable list of templates with active indicator"
      min_lines: 40
    - path: "src/components/templates/TemplateEditor.tsx"
      provides: "Form for editing template name, type, prompts, model override"
      min_lines: 80
    - path: "src/components/templates/TemplateManager.tsx"
      provides: "Combined template management UI with list and editor"
      min_lines: 30
  key_links:
    - from: "src/components/templates/TemplateList.tsx"
      to: "src/store/index.ts"
      via: "useStore for templates and setActiveTemplate"
      pattern: "useStore.*templates"
    - from: "src/components/templates/TemplateEditor.tsx"
      to: "src/store/index.ts"
      via: "useStore for updateTemplate"
      pattern: "useStore.*updateTemplate"
---

<objective>
Create the Template Manager UI for viewing, creating, editing, and deleting prompt templates.

Purpose: Allow users to manage prompt templates for different interview types. Templates define system prompts and user prompt patterns with variable substitution for $highlighted, $recent, $transcript.

Output: Complete template management interface that integrates with the popup's Templates tab.
</objective>

<execution_context>
@/Users/sasha-marchuk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sasha-marchuk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-prompts-settings/06-RESEARCH.md

# Prior plan output
@.planning/phases/06-prompts-settings/06-01-SUMMARY.md

# Store (from Plan 01)
@src/store/index.ts
@src/store/types.ts
@src/store/defaultTemplates.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TemplateList component</name>
  <files>
    src/components/templates/TemplateList.tsx
  </files>
  <action>
Create `src/components/templates/TemplateList.tsx`:

1. Import useStore from store and PromptTemplate type

2. Get from store:
   - templates array
   - activeTemplateId
   - setActiveTemplate function
   - deleteTemplate function
   - addTemplate function

3. Render a list of templates:
   - Each item shows:
     - Template name (bold if active)
     - Template type badge (system-design, coding, behavioral, custom)
     - Blue border/background highlight if active
   - Click on item calls setActiveTemplate(id)

4. Add "New Template" button at bottom of list:
   - On click, call addTemplate with:
     - name: 'New Template'
     - type: 'custom'
     - systemPrompt: ''
     - userPromptTemplate: 'Question: $highlighted\n\nContext: $recent'
     - isDefault: false
   - After adding, set it as active

5. Delete button for non-default templates:
   - Show small X or trash icon
   - Only visible if isDefault is false
   - On click, call deleteTemplate(id)
   - Use stopPropagation to prevent selecting the template

6. Style with Tailwind:
   - Vertical list with spacing
   - Hover states on items
   - Active state with blue accent
   - Type badges with colors: system-design=purple, coding=green, behavioral=orange, custom=gray
  </action>
  <verify>
    - File exists at src/components/templates/TemplateList.tsx
    - Imports useStore correctly
    - Has handlers for add, delete, select
    - Run `npx tsc --noEmit` passes
  </verify>
  <done>
    TemplateList component renders templates with selection, creation, and deletion functionality.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TemplateEditor component</name>
  <files>
    src/components/templates/TemplateEditor.tsx
  </files>
  <action>
Create `src/components/templates/TemplateEditor.tsx`:

1. Import useStore and PromptTemplate type

2. Get from store:
   - templates array
   - activeTemplateId
   - updateTemplate function

3. Find the active template:
   ```typescript
   const template = templates.find(t => t.id === activeTemplateId);
   ```

4. If no active template, show "Select a template to edit"

5. Render edit form for active template:

   a) Name field (text input):
      - Disabled if isDefault (can't rename defaults)
      - On change, call updateTemplate(id, { name: value })

   b) Type field (select dropdown):
      - Options: system-design, coding, behavioral, custom
      - Disabled if isDefault
      - On change, call updateTemplate(id, { type: value })

   c) System Prompt (textarea):
      - Large textarea for system instructions
      - Placeholder: "Instructions for the AI..."
      - On change (debounced 500ms), call updateTemplate(id, { systemPrompt: value })
      - Note below: "This sets the AI's behavior and expertise"

   d) User Prompt Template (textarea):
      - Large textarea for the user prompt pattern
      - Placeholder: "Question: $highlighted\n\nContext: $recent"
      - On change (debounced 500ms), call updateTemplate(id, { userPromptTemplate: value })
      - Note below: "Variables: $highlighted, $recent, $transcript"

   e) Model Override (select dropdown):
      - Optional field
      - First option: "Use default model" (empty string)
      - Other options: same models from ModelSettings
      - On change, call updateTemplate(id, { modelOverride: value || undefined })
      - Note: "Override the default full model for this template"

6. Use useState for local form values to enable debouncing:
   - Initialize from template when activeTemplateId changes
   - Debounce updates to store (prevents excessive chrome.storage writes)
   - Use useEffect to sync local state when template changes

7. Style with Tailwind:
   - Labels above inputs
   - Full-width textareas with min-height
   - Subtle borders and rounded corners
   - Disabled inputs visually distinct
  </action>
  <verify>
    - File exists at src/components/templates/TemplateEditor.tsx
    - Imports useStore correctly
    - Has all five fields: name, type, systemPrompt, userPromptTemplate, modelOverride
    - Disabled state for default templates
    - Run `npx tsc --noEmit` passes
  </verify>
  <done>
    TemplateEditor component provides full editing interface for prompt templates with proper debouncing.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create TemplateManager and integrate with popup</name>
  <files>
    src/components/templates/TemplateManager.tsx
    entrypoints/popup/App.tsx
  </files>
  <action>
1. Create `src/components/templates/TemplateManager.tsx`:
   - Import TemplateList and TemplateEditor
   - Render side-by-side or stacked layout:
     - TemplateList on left/top (narrower, ~1/3 width)
     - TemplateEditor on right/bottom (wider, ~2/3 width)
   - Use flexbox with gap
   - For popup width constraints, use stacked layout (list above, editor below)

2. Update `entrypoints/popup/App.tsx`:
   - Import TemplateManager from '../../src/components/templates/TemplateManager'
   - Replace the "Template management coming soon" placeholder in Templates tab
   - Render TemplateManager component when Templates tab is active

3. Layout considerations for popup:
   - Popup is w-96 (384px) - not enough for side-by-side
   - Use vertical stack: list at top, editor below
   - Add scrolling to handle content overflow
   - Templates tab may need more height - consider max-h-[600px]
  </action>
  <verify>
    - TemplateManager.tsx exists and imports both List and Editor
    - App.tsx imports and renders TemplateManager in Templates tab
    - Run `npx tsc --noEmit` passes
    - Run `npm run build` succeeds
  </verify>
  <done>
    TemplateManager created and integrated into popup's Templates tab, replacing placeholder.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Type check passes:
   ```bash
   npx tsc --noEmit
   ```

2. Build succeeds:
   ```bash
   npm run build
   ```

3. Manual test in browser:
   - Load extension
   - Click extension icon, go to Templates tab
   - See list of 3 default templates (System Design, Coding, Behavioral)
   - Click a template - it becomes active (highlighted)
   - Editor shows template content
   - Edit system prompt - change persists after closing/reopening
   - Click "New Template" - new custom template appears
   - Can edit and delete custom template
   - Cannot delete default templates
   - Can set model override on any template

4. Console shows no errors
</verification>

<success_criteria>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Templates tab shows template list and editor
4. Three default templates visible (System Design, Coding, Behavioral)
5. Can create new custom templates
6. Can edit template content (prompts, model override)
7. Can delete custom templates (not defaults)
8. Template changes persist across popup open/close
9. Active template visually highlighted
10. No console errors when managing templates
</success_criteria>

<output>
After completion, create `.planning/phases/06-prompts-settings/06-03-SUMMARY.md`
</output>
