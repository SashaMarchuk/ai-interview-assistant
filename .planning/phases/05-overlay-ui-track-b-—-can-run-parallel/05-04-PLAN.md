---
phase: 05-overlay-ui
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - src/overlay/index.ts
  - entrypoints/content.tsx
  - src/components/OverlayPlaceholder.tsx
autonomous: false

must_haves:
  truths:
    - "User sees floating overlay with transcript and response panels on Google Meet page"
    - "User can drag overlay header to reposition overlay"
    - "User can resize overlay from edges and corner"
    - "Overlay position and size persist after page refresh"
    - "Overlay has transparent blurred background showing page beneath"
    - "User can minimize overlay to button and expand it back"
    - "Mock transcript entries display with speaker colors"
    - "Mock response displays fast hint and full answer sections"
  artifacts:
    - path: "src/overlay/index.ts"
      provides: "Barrel export for overlay module"
      exports: ["Overlay", "TranscriptPanel", "ResponsePanel"]
    - path: "entrypoints/content.tsx"
      provides: "Content script with full overlay integration"
      min_lines: 40
  key_links:
    - from: "entrypoints/content.tsx"
      to: "src/overlay/Overlay.tsx"
      via: "import { Overlay }"
      pattern: "from '../src/overlay'"
    - from: "src/overlay/Overlay.tsx"
      to: "src/overlay/TranscriptPanel.tsx"
      via: "child component"
      pattern: "<TranscriptPanel"
---

<objective>
Integrate overlay components, wire up with mock data, update content script, and verify complete overlay functionality.

Purpose: Wire all overlay components together into a working system with mock data for development testing. This is the integration and verification step that confirms all Phase 5 requirements are met.

Output: Complete overlay system with TranscriptPanel and ResponsePanel inside Overlay, content script updated to use new components, mock data displayed for development, visual verification checkpoint.
</objective>

<execution_context>
@/Users/sasha-marchuk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sasha-marchuk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-overlay-ui-track-b-—-can-run-parallel/05-RESEARCH.md
@.planning/phases/05-overlay-ui-track-b-—-can-run-parallel/05-01-SUMMARY.md
@.planning/phases/05-overlay-ui-track-b-—-can-run-parallel/05-02-SUMMARY.md
@.planning/phases/05-overlay-ui-track-b-—-can-run-parallel/05-03-SUMMARY.md

# Files created in prior plans
@src/overlay/Overlay.tsx
@src/overlay/OverlayHeader.tsx
@src/overlay/TranscriptPanel.tsx
@src/overlay/ResponsePanel.tsx
@src/types/transcript.ts

# File to update
@entrypoints/content.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create overlay barrel export and update Overlay to include panels</name>
  <files>src/overlay/index.ts, src/overlay/Overlay.tsx</files>
  <action>
Create `src/overlay/index.ts` barrel export:

```typescript
// Overlay module barrel export
export { Overlay } from './Overlay';
export { OverlayHeader } from './OverlayHeader';
export { TranscriptPanel } from './TranscriptPanel';
export { ResponsePanel } from './ResponsePanel';

// Re-export hooks for convenience
export { useOverlayPosition } from './hooks/useOverlayPosition';
export { useAutoScroll } from './hooks/useAutoScroll';
```

Update `src/overlay/Overlay.tsx` to integrate TranscriptPanel and ResponsePanel with mock data:

```typescript
import { useState, useEffect } from 'react';
import { Rnd } from 'react-rnd';
import { useOverlayPosition } from './hooks/useOverlayPosition';
import { OverlayHeader } from './OverlayHeader';
import { TranscriptPanel } from './TranscriptPanel';
import { ResponsePanel } from './ResponsePanel';
import {
  type TranscriptEntry,
  type LLMResponse,
  MOCK_TRANSCRIPT,
  MOCK_RESPONSE,
} from '../types/transcript';

interface OverlayProps {
  // These props will be used in Phase 7 for real data
  // For now, we use mock data internally
  transcript?: TranscriptEntry[];
  response?: LLMResponse | null;
}

/**
 * Main overlay container with drag and resize functionality.
 * Uses react-rnd for interaction and persists position/size to chrome.storage.
 *
 * In Phase 5, uses mock data for development.
 * In Phase 7, will receive real data via props.
 */
export function Overlay({ transcript, response }: OverlayProps) {
  const {
    position,
    size,
    isMinimized,
    isLoaded,
    setPosition,
    setSize,
    setMinimized,
  } = useOverlayPosition();

  // Use mock data if no real data provided (Phase 5 development mode)
  const [mockTranscript] = useState<TranscriptEntry[]>(MOCK_TRANSCRIPT);
  const [mockResponse] = useState<LLMResponse | null>(MOCK_RESPONSE);

  const displayTranscript = transcript ?? mockTranscript;
  const displayResponse = response ?? mockResponse;

  // Don't render until initial position loaded from storage
  // This prevents flash of default position
  if (!isLoaded) {
    return null;
  }

  // Minimized state: render small expandable button
  if (isMinimized) {
    return (
      <Rnd
        position={position}
        size={{ width: 140, height: 36 }}
        enableResizing={false}
        bounds="window"
        onDragStop={(e, d) => setPosition({ x: d.x, y: d.y })}
        className="z-[999999]"
      >
        <button
          onClick={() => setMinimized(false)}
          className="w-full h-full bg-blue-500 text-white rounded-lg shadow-lg hover:bg-blue-600 text-sm font-medium px-3 flex items-center justify-center gap-2 transition-colors"
          title="Expand AI Assistant"
        >
          <span>AI Assistant</span>
          <span className="text-blue-200">+</span>
        </button>
      </Rnd>
    );
  }

  // Full expanded state with drag/resize
  return (
    <Rnd
      position={position}
      size={size}
      onDragStop={(e, d) => setPosition({ x: d.x, y: d.y })}
      onResizeStop={(e, dir, ref, delta, pos) => {
        setSize({
          width: parseInt(ref.style.width, 10),
          height: parseInt(ref.style.height, 10),
        });
        setPosition(pos);
      }}
      dragHandleClassName="overlay-drag-handle"
      minWidth={280}
      minHeight={200}
      maxWidth={700}
      maxHeight={900}
      bounds="window"
      enableResizing={{
        top: false,
        right: true,
        bottom: true,
        left: false,
        topRight: false,
        bottomRight: true,
        bottomLeft: false,
        topLeft: false,
      }}
      className="z-[999999]"
      resizeHandleStyles={{
        right: { cursor: 'ew-resize' },
        bottom: { cursor: 'ns-resize' },
        bottomRight: { cursor: 'nwse-resize' },
      }}
    >
      <div className="overlay-container h-full flex flex-col bg-white/90 backdrop-blur-sm rounded-lg shadow-xl border border-gray-200 overflow-hidden">
        <OverlayHeader onMinimize={() => setMinimized(true)} />

        {/* Content area with panels */}
        <div className="flex-1 p-4 overflow-hidden flex flex-col gap-3">
          <TranscriptPanel entries={displayTranscript} />
          <ResponsePanel response={displayResponse} />
        </div>

        {/* Footer with status indicator */}
        <div className="px-4 py-2 bg-gray-50 border-t flex items-center justify-between text-xs text-gray-400">
          <span>AI Interview Assistant</span>
          <span className="flex items-center gap-1">
            <span className="w-2 h-2 bg-green-400 rounded-full"></span>
            Ready
          </span>
        </div>
      </div>
    </Rnd>
  );
}
```

Key changes:
- Imports TranscriptPanel and ResponsePanel
- Uses mock data from src/types/transcript.ts
- Props allow real data override (for Phase 7 integration)
- Displays both panels in content area
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
Run `npm run build` to verify build succeeds.
Confirm files exist at correct paths.
  </verify>
  <done>
src/overlay/index.ts provides barrel exports for overlay module.
src/overlay/Overlay.tsx integrates TranscriptPanel and ResponsePanel.
Mock data displays when no props provided.
Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update content script to use new Overlay component</name>
  <files>entrypoints/content.tsx</files>
  <action>
Update `entrypoints/content.tsx` to use the new Overlay component:

```typescript
import { createRoot } from 'react-dom/client';
import { Overlay } from '../src/overlay';
import '../src/assets/app.css';

// Only inject on active Google Meet meeting pages (not landing/join pages)
// Meeting URL pattern: meet.google.com/xxx-xxxx-xxx
const MEET_URL_PATTERN = /^https:\/\/meet\.google\.com\/[a-z]{3}-[a-z]{4}-[a-z]{3}/i;

export default defineContentScript({
  matches: ['https://meet.google.com/*'],
  runAt: 'document_idle',
  cssInjectionMode: 'ui',

  async main(ctx) {
    // Check if this is an active meeting page (not landing/join page)
    if (!MEET_URL_PATTERN.test(window.location.href)) {
      console.log('AI Interview Assistant: Not a meeting page, skipping injection');
      return;
    }

    console.log('AI Interview Assistant: Content script loaded on Meet page');

    // Create UI container using WXT's createShadowRootUi for proper isolation
    const ui = await createShadowRootUi(ctx, {
      name: 'ai-interview-assistant',
      position: 'inline',
      anchor: 'body',
      onMount: (container) => {
        // Create React root inside shadow DOM
        const root = createRoot(container);
        // Render the full overlay with mock data (Phase 5)
        // In Phase 7, real data will be passed via message handlers
        root.render(<Overlay />);
        return root;
      },
      onRemove: (root) => {
        root?.unmount();
      },
    });

    ui.mount();
    console.log('AI Interview Assistant: Overlay injected with drag/resize support');

    // Notify background that UI is ready
    try {
      await chrome.runtime.sendMessage({
        type: 'UI_INJECTED',
        success: true,
      });
    } catch (error) {
      console.warn('Failed to notify UI injection:', error);
    }
  },
});
```

Key changes:
- Import Overlay from '../src/overlay' (barrel export)
- Render Overlay instead of OverlayPlaceholder
- Updated log message to mention drag/resize support
  </action>
  <verify>
Run `npm run build` to verify build succeeds.
Load extension in Chrome and navigate to a Google Meet URL.
Confirm overlay appears with mock data.
  </verify>
  <done>
entrypoints/content.tsx imports and renders new Overlay component.
Old OverlayPlaceholder import removed.
Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove deprecated OverlayPlaceholder or mark for deletion</name>
  <files>src/components/OverlayPlaceholder.tsx</files>
  <action>
The old OverlayPlaceholder.tsx is no longer used. Options:

Option A (Recommended): Delete the file
```bash
rm src/components/OverlayPlaceholder.tsx
```

Option B: Keep for reference, add deprecation comment
```typescript
/**
 * @deprecated This component was replaced by src/overlay/Overlay.tsx in Phase 5.
 * Will be removed in Phase 7 cleanup.
 */
// ... rest of file
```

Go with Option A - delete the file since the new Overlay is a complete replacement.
Also remove the src/components directory if it's now empty:
```bash
rmdir src/components 2>/dev/null || true
```
  </action>
  <verify>
Confirm src/components/OverlayPlaceholder.tsx no longer exists.
Run `npm run build` to verify no missing import errors.
  </verify>
  <done>
src/components/OverlayPlaceholder.tsx deleted.
No references to deprecated component remain.
Build succeeds.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete floating overlay with:
- Draggable by header to any screen position
- Resizable from right edge, bottom edge, or bottom-right corner
- Position and size persist across page refresh
- Transparent blurred background
- Minimize/expand toggle
- Transcript panel with speaker-colored labels
- Response panel with fast hint (green) and full answer (purple)
- Mock data displaying for development
  </what-built>
  <how-to-verify>
1. Start the development server: `npm run dev`
2. Open Chrome and load the extension from `.output/chrome-mv3`
3. Navigate to a Google Meet page (use a test URL like meet.google.com/abc-defg-hij)
4. Verify overlay appears at bottom-right with mock data:
   - Transcript shows 3 mock entries with "Interviewer" (purple) and "You" (blue) labels
   - Response shows "Quick Hint" (green) and "Full Answer" (purple) sections
5. Test drag: Grab header and drag overlay to different position
6. Test resize: Grab right edge, bottom edge, or bottom-right corner and resize
7. Refresh the page: Verify overlay appears at saved position and size (no flash)
8. Test minimize: Click "-" button, confirm overlay minimizes to small button
9. Test expand: Click minimized button, confirm overlay expands back
10. Verify transparency: Check that page content is visible through overlay background blur
  </how-to-verify>
  <resume-signal>
Type "approved" if all verification steps pass.
If issues found, describe what's not working.
  </resume-signal>
</task>

</tasks>

<verification>
1. Run `npm run build` - build succeeds
2. Run `npm run dev` - dev server starts
3. Load extension in Chrome
4. Navigate to Google Meet test page
5. Visual verification of:
   - Overlay appears with mock data
   - Drag functionality works
   - Resize functionality works
   - Position persists after refresh
   - Minimize/expand works
   - Blur transparency visible
</verification>

<success_criteria>
- Overlay module has barrel export at src/overlay/index.ts
- Content script renders new Overlay component
- Old OverlayPlaceholder deleted
- Mock transcript displays with speaker colors
- Mock response displays with fast hint and full answer sections
- Drag, resize, minimize, persist all work correctly
- Visual verification passes
</success_criteria>

<output>
After completion, create `.planning/phases/05-overlay-ui-track-b-—-can-run-parallel/05-04-SUMMARY.md`
</output>
