---
phase: 13-compliance-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/types.ts
  - src/store/consentSlice.ts
  - src/store/index.ts
  - src/components/consent/PrivacyPolicyContent.tsx
autonomous: true

must_haves:
  truths:
    - "ConsentSlice interface exists with privacyPolicyAccepted, privacyPolicyAcceptedAt, recordingConsentDismissedPermanently state and acceptPrivacyPolicy, dismissRecordingConsentPermanently, resetAllConsents actions"
    - "StoreState includes ConsentSlice in its union"
    - "Consent state fields are persisted via partialize and survive popup close/reopen"
    - "Privacy policy text is a reusable React component covering what data is captured, where it is sent, and what is stored"
  artifacts:
    - path: "src/store/types.ts"
      provides: "ConsentSlice interface and updated StoreState type"
      contains: "ConsentSlice"
    - path: "src/store/consentSlice.ts"
      provides: "Consent state defaults and action implementations"
      exports: ["createConsentSlice"]
    - path: "src/store/index.ts"
      provides: "consentSlice combined into store, consent fields in partialize"
      contains: "createConsentSlice"
    - path: "src/components/consent/PrivacyPolicyContent.tsx"
      provides: "Privacy policy text component for reuse in modal and standalone views"
      exports: ["PrivacyPolicyContent"]
  key_links:
    - from: "src/store/consentSlice.ts"
      to: "src/store/types.ts"
      via: "ConsentSlice type import"
      pattern: "import.*ConsentSlice.*from.*types"
    - from: "src/store/index.ts"
      to: "src/store/consentSlice.ts"
      via: "createConsentSlice spread in store creation"
      pattern: "createConsentSlice"
    - from: "src/store/index.ts"
      to: "partialize consent fields"
      via: "privacyPolicyAccepted in partialize return"
      pattern: "privacyPolicyAccepted.*state\\.privacyPolicyAccepted"
---

<objective>
Create the consent state layer (Zustand slice + types) and the reusable privacy policy content component.

Purpose: Establish the state foundation that the UI gates (Plan 02) will consume, and prepare the privacy policy text that appears in both the first-time consent modal and the always-accessible policy view.

Output: ConsentSlice with three state fields and three actions, integrated into the combined store with persistence, plus a PrivacyPolicyContent React component.
</objective>

<execution_context>
@/Users/sasha-marchuk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sasha-marchuk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/store/types.ts
@src/store/settingsSlice.ts
@src/store/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConsentSlice types and slice implementation</name>
  <files>src/store/types.ts, src/store/consentSlice.ts</files>
  <action>
**In `src/store/types.ts`:**

1. Add a `ConsentSlice` interface after the `TemplatesSlice` interface:
```typescript
export interface ConsentSlice {
  /** Whether user has accepted the privacy policy (first-time gate) */
  privacyPolicyAccepted: boolean;
  /** ISO timestamp when privacy policy was accepted */
  privacyPolicyAcceptedAt: string | null;
  /** Whether user permanently dismissed per-session recording consent */
  recordingConsentDismissedPermanently: boolean;
  /** Accept the privacy policy (sets accepted=true with timestamp) */
  acceptPrivacyPolicy: () => void;
  /** Permanently dismiss the per-session recording consent */
  dismissRecordingConsentPermanently: () => void;
  /** Reset all consent acknowledgments (re-trigger all flows) */
  resetAllConsents: () => void;
}
```

2. Update `StoreState` from `SettingsSlice & TemplatesSlice` to `SettingsSlice & TemplatesSlice & ConsentSlice`.

**In `src/store/consentSlice.ts`:**

Create a new file following the exact pattern of `settingsSlice.ts`:

```typescript
import type { StateCreator } from 'zustand';
import type { ConsentSlice, StoreState } from './types';

export const createConsentSlice: StateCreator<StoreState, [], [], ConsentSlice> = (set) => ({
  // State defaults
  privacyPolicyAccepted: false,
  privacyPolicyAcceptedAt: null,
  recordingConsentDismissedPermanently: false,

  // Actions
  acceptPrivacyPolicy: () => {
    set(() => ({
      privacyPolicyAccepted: true,
      privacyPolicyAcceptedAt: new Date().toISOString(),
    }));
  },

  dismissRecordingConsentPermanently: () => {
    set(() => ({
      recordingConsentDismissedPermanently: true,
    }));
  },

  resetAllConsents: () => {
    set(() => ({
      privacyPolicyAccepted: false,
      privacyPolicyAcceptedAt: null,
      recordingConsentDismissedPermanently: false,
    }));
  },
});
```

Use the same JSDoc header comment pattern as settingsSlice.ts.
  </action>
  <verify>Run `npx tsc --noEmit` from project root. No type errors related to ConsentSlice, StoreState, or consentSlice.ts.</verify>
  <done>ConsentSlice interface exists in types.ts, StoreState includes ConsentSlice, consentSlice.ts exports createConsentSlice with three state fields and three action implementations.</done>
</task>

<task type="auto">
  <name>Task 2: Wire consent slice into store and create privacy policy component</name>
  <files>src/store/index.ts, src/components/consent/PrivacyPolicyContent.tsx</files>
  <action>
**In `src/store/index.ts`:**

1. Add import: `import { createConsentSlice } from './consentSlice';`
2. Spread `...createConsentSlice(...a)` into the store creation alongside the existing slices.
3. Add consent fields to the `partialize` function:
   - `privacyPolicyAccepted: state.privacyPolicyAccepted,`
   - `privacyPolicyAcceptedAt: state.privacyPolicyAcceptedAt,`
   - `recordingConsentDismissedPermanently: state.recordingConsentDismissedPermanently,`
4. Add `ConsentSlice` to the re-export types at bottom of file.

CRITICAL: The `partialize` inclusion is mandatory -- without it, consent resets on every popup reopen (Pitfall 1 from research). Do NOT reset consent state in `onRehydrateStorage`.

**In `src/components/consent/PrivacyPolicyContent.tsx`:**

Create directory `src/components/consent/` and the component. This is a static React component containing the privacy policy text. Content should cover:

1. **What Data Is Captured:** Tab audio from browser tabs (interviewer's voice), microphone audio (your voice). No audio is recorded or stored -- only transcribed in real-time.
2. **Where Data Is Sent:** ElevenLabs API for speech-to-text transcription, OpenRouter or OpenAI API for AI-generated responses. Data is sent directly from your browser -- no intermediate servers.
3. **What Is Stored Locally:** API keys (encrypted with AES-GCM-256 in chrome.storage.local), user preferences and prompt templates, consent acknowledgments. No audio, transcripts, or AI responses are persisted.
4. **Third-Party Services:** ElevenLabs (transcription), OpenRouter (LLM routing), OpenAI (direct LLM). Each service has its own privacy policy. Your API keys authenticate directly with these services.
5. **Data Sharing:** No data is shared with the extension developer or any third party beyond the configured API providers. All processing happens locally or directly with your chosen API providers.
6. **Your Rights:** You can delete all stored data by removing the extension. You can reset consent acknowledgments in Settings. You control which API providers to use via your own API keys.

Style with Tailwind: `prose prose-sm` for readable text, `max-h-[300px] overflow-y-auto` for scrollability within popup constraints, appropriate padding and text colors matching existing gray-700 text.

Mark with a small italic note at the bottom: "This is a draft privacy policy for personal use. Consult a legal professional for distribution."

Export as a named export: `export function PrivacyPolicyContent()`.
  </action>
  <verify>Run `npx tsc --noEmit` -- no type errors. Verify consent fields appear in the partialize function by reading the file. Verify PrivacyPolicyContent.tsx exists and exports the component.</verify>
  <done>Store combines consent slice, consent fields persist via partialize, PrivacyPolicyContent component exists with complete policy text covering data capture, transmission, storage, third-party services, and user rights.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `src/store/consentSlice.ts` exists and exports `createConsentSlice`
3. `src/store/types.ts` contains `ConsentSlice` interface and `StoreState` includes it
4. `src/store/index.ts` spreads `createConsentSlice`, partalizes all three consent fields
5. `src/components/consent/PrivacyPolicyContent.tsx` exists with scrollable policy content
6. `npx wxt build` succeeds (extension builds cleanly)
</verification>

<success_criteria>
- ConsentSlice type and implementation follow the exact same StateCreator pattern as settingsSlice.ts
- StoreState = SettingsSlice & TemplatesSlice & ConsentSlice
- All three consent state fields (privacyPolicyAccepted, privacyPolicyAcceptedAt, recordingConsentDismissedPermanently) are in partialize
- PrivacyPolicyContent renders scrollable privacy policy text
- TypeScript builds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-compliance-ui/13-01-SUMMARY.md`
</output>
