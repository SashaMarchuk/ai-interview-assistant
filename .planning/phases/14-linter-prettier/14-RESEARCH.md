# Phase 14: Linter & Prettier - Research

**Researched:** 2026-02-09
**Domain:** Code quality tooling (ESLint + Prettier) for TypeScript/React Chrome Extension
**Confidence:** HIGH

## Summary

This phase adds automated code formatting and linting to the project. The project currently has **zero** ESLint or Prettier configuration -- no `.eslintrc`, no `eslint.config.*`, no `.prettierrc`, no `prettier.config.*`. The codebase is clean (57 TS/TSX files, only one `as any` in `wxt.config.ts` which is already documented).

ESLint v10.0.0 was released on 2026-02-06 and is available via `npx eslint` (v10.0.0). It exclusively uses the **flat config** format (`eslint.config.mjs`) -- the legacy `.eslintrc` system has been completely removed. Prettier 3.8.1 is available. Node.js 22.18.0 satisfies ESLint 10's requirement of `^22.13.0`.

The Claude Code hooks system supports `PostToolUse` hooks with `Edit|Write` matcher, which is the exact mechanism needed for auto-formatting after every file edit. The project-level `.claude/settings.json` is the correct place for this hook.

**Primary recommendation:** Use ESLint 10 flat config with `typescript-eslint` v8 `recommended` preset + `eslint-plugin-react-hooks` + `eslint-config-prettier`. Use Prettier with `prettier-plugin-tailwindcss`. Add a `PostToolUse` hook in `.claude/settings.json` to auto-format on every Edit/Write.

## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| `eslint` | ^10.0.0 | JavaScript/TypeScript linter | Industry standard, just released v10 with flat config only |
| `@eslint/js` | ^10.0.0 | ESLint's own recommended rules | Official base config, ships with ESLint 10 |
| `typescript-eslint` | ^8.54.0 | TypeScript-specific ESLint rules | Official TS linting, unified package for parser + plugin + configs |
| `prettier` | ^3.8.1 | Code formatter | Industry standard, opinionated formatter |
| `eslint-config-prettier` | ^10.x | Disables ESLint rules conflicting with Prettier | Official bridge -- prevents ESLint/Prettier conflicts |
| `globals` | ^17.3.0 | Global variable definitions for ESLint | Required for `browser` and `webextensions` globals in flat config |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| `eslint-plugin-react-hooks` | ^7.0.1 | Enforces Rules of Hooks | Required -- project uses React hooks extensively |
| `prettier-plugin-tailwindcss` | latest | Auto-sorts Tailwind CSS classes | Project uses Tailwind v4 -- needs `tailwindStylesheet` option |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| `recommended` config | `strict` / `strict-type-checked` | `strict` is more opinionated, may flag too many patterns. `recommended` is safe baseline |
| `recommended` (non type-checked) | `recommended-type-checked` | Type-checked rules are slower (need full TS program), more powerful. Can add later |
| `eslint-plugin-react` | Nothing (skip it) | React-specific rules beyond hooks. Not essential -- TypeScript catches most issues. Can add later |
| `eslint-plugin-prettier` | Just `eslint-config-prettier` | Running Prettier through ESLint is slower and adds complexity. Better to run separately |

**Installation:**
```bash
npm install -D eslint @eslint/js typescript-eslint globals eslint-config-prettier eslint-plugin-react-hooks prettier prettier-plugin-tailwindcss
```

## Architecture Patterns

### Recommended Project Structure
```
project-root/
+-- eslint.config.mjs          # ESLint 10 flat config (ONLY format supported)
+-- .prettierrc.json            # Prettier config (JSON for simplicity)
+-- .prettierignore             # Files Prettier should skip
+-- .claude/
|   +-- settings.json           # PostToolUse hook for auto-formatting
+-- .wxt/
|   +-- eslint-auto-imports.mjs # Generated by WXT (auto-import globals)
```

### Pattern 1: ESLint 10 Flat Config with defineConfig
**What:** Single `eslint.config.mjs` using ESLint 10's `defineConfig()` helper
**When to use:** Always -- this is the only config format ESLint 10 supports
**Example:**
```javascript
// Source: https://eslint.org/docs/latest/use/configure/configuration-files
// Source: https://typescript-eslint.io/getting-started/
// @ts-check
import eslint from '@eslint/js';
import { defineConfig } from 'eslint/config';
import tseslint from 'typescript-eslint';
import eslintConfigPrettier from 'eslint-config-prettier/flat';
import reactHooks from 'eslint-plugin-react-hooks';
import globals from 'globals';

export default defineConfig(
  // Globally ignored paths
  { ignores: ['.output/', '.wxt/', 'node_modules/', 'public/'] },

  // Base ESLint recommended
  eslint.configs.recommended,

  // TypeScript recommended
  tseslint.configs.recommended,

  // Browser + WebExtension globals
  {
    languageOptions: {
      globals: {
        ...globals.browser,
        ...globals.webextensions,
      },
    },
  },

  // React Hooks rules
  reactHooks.configs.flat.recommended,

  // WXT auto-imports (generated file)
  // Import from './.wxt/eslint-auto-imports.mjs' after enabling in wxt.config.ts

  // Prettier must be LAST -- disables conflicting rules
  eslintConfigPrettier,
);
```

### Pattern 2: WXT Auto-Import ESLint Integration
**What:** WXT generates `.wxt/eslint-auto-imports.mjs` containing global declarations for auto-imported functions
**When to use:** When WXT auto-imports are enabled (they are in this project)
**Example (wxt.config.ts addition):**
```typescript
// Source: https://wxt.dev/guide/essentials/config/auto-imports
export default defineConfig({
  imports: {
    eslintrc: {
      enabled: 9, // Use 9 for ESLint 9+ flat config format
    },
  },
  // ... rest of config
});
```

Then in `eslint.config.mjs`, import and include:
```javascript
import autoImports from './.wxt/eslint-auto-imports.mjs';
// Add autoImports to the config array
```

### Pattern 3: Claude Code PostToolUse Hook
**What:** Auto-runs formatting after every file Claude edits
**When to use:** Always -- this is success criterion #3
**Example (.claude/settings.json):**
```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | xargs npx prettier --write 2>/dev/null; jq -r '.tool_input.file_path' | xargs npx eslint --fix 2>/dev/null; exit 0"
          }
        ]
      }
    ]
  }
}
```

**Important:** The hook receives JSON on stdin containing `tool_input.file_path`. Use `jq` to extract it. Always `exit 0` to avoid blocking Claude's workflow. Run prettier first (fast), then eslint --fix (slower).

### Pattern 4: Prettier Config for Tailwind v4
**What:** Prettier with Tailwind class sorting for v4 projects
**When to use:** Project uses Tailwind v4 with custom theme in CSS
**Example (.prettierrc.json):**
```json
{
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 100,
  "tabWidth": 2,
  "semi": true,
  "plugins": ["prettier-plugin-tailwindcss"],
  "tailwindStylesheet": "./src/assets/app.css"
}
```

**Note:** `tailwindStylesheet` is required for Tailwind v4 to read custom theme/utilities from the CSS file. Without it, the plugin uses the default theme and may sort incorrectly.

### Anti-Patterns to Avoid
- **Running Prettier through ESLint (eslint-plugin-prettier):** Slower, noisier, harder to debug. Run them separately instead.
- **Using `.eslintrc.*` files:** Completely removed in ESLint 10. Only `eslint.config.*` works.
- **Using `.eslintignore`:** Removed in ESLint 10. Use `ignores` array in flat config instead.
- **Type-checked configs without need:** `recommended-type-checked` requires full TypeScript program, significantly slower. Start with `recommended` and upgrade only if needed.
- **Not putting eslint-config-prettier LAST:** It must override all other configs to properly disable conflicting rules.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| ESLint/Prettier conflicts | Manual rule disabling | `eslint-config-prettier` | Maintains 60+ rule overrides, stays current with both tools |
| Tailwind class ordering | Custom sort logic | `prettier-plugin-tailwindcss` | Official plugin, handles v4 themes, removes duplicates |
| WXT auto-import globals | Manual ESLint global declarations | WXT's `eslintrc.enabled: 9` | Auto-generates from actual auto-import config, stays in sync |
| React hooks lint rules | Custom no-dependency rules | `eslint-plugin-react-hooks` | Official React team plugin, handles all hook patterns |

**Key insight:** The entire ESLint + Prettier ecosystem is designed to be composed from official presets. Hand-rolling rules leads to subtle conflicts and maintenance burden.

## Common Pitfalls

### Pitfall 1: ESLint 10 vs 9 Config Confusion
**What goes wrong:** Many tutorials/examples still show ESLint 9 syntax. ESLint 10 removed `ESLINT_USE_FLAT_CONFIG` env var and legacy config entirely.
**Why it happens:** ESLint 10 was released 2026-02-06 (3 days ago). Most online resources target ESLint 9 or earlier.
**How to avoid:** Use `defineConfig()` from `eslint/config` (ESLint 10 native). Ignore any `.eslintrc` examples.
**Warning signs:** `eslint.config.js` (CJS) may fail since project is `"type": "module"`. Use `.mjs` extension.

### Pitfall 2: WXT Auto-Import Globals Not in ESLint
**What goes wrong:** ESLint reports `no-undef` errors for WXT auto-imported functions like `defineBackground`, `browser`, `storage`, `useState`.
**Why it happens:** WXT auto-imports these at build time, but ESLint doesn't know about them.
**How to avoid:** Enable `imports.eslintrc.enabled: 9` in `wxt.config.ts`, then run `wxt prepare` to generate `.wxt/eslint-auto-imports.mjs`. Import this file in `eslint.config.mjs`.
**Warning signs:** Many `no-undef` errors on WXT/React globals that work fine at runtime.

### Pitfall 3: Node.js Version Requirement
**What goes wrong:** ESLint 10 fails to start.
**Why it happens:** ESLint 10 requires `^20.19.0 || ^22.13.0 || >=24`. Node 21.x or early 22.x won't work.
**How to avoid:** Current project uses Node 22.18.0 which is fine. Document requirement.
**Warning signs:** Startup errors mentioning Node.js version.

### Pitfall 4: Prettier + Tailwind v4 Missing tailwindStylesheet
**What goes wrong:** Custom Tailwind classes are sorted incorrectly or not recognized.
**Why it happens:** Without `tailwindStylesheet`, the plugin uses default Tailwind theme. v4 stores theme in CSS, not `tailwind.config.js`.
**How to avoid:** Set `"tailwindStylesheet": "./src/assets/app.css"` in `.prettierrc.json`.
**Warning signs:** Class sorting seems random or wrong for custom utilities.

### Pitfall 5: Hook stdin Parsing
**What goes wrong:** Claude Code hook fails with JSON parse error.
**Why it happens:** Shell profile (`.zshrc`) outputs text that gets prepended to hook's stdin JSON.
**How to avoid:** Use `jq` for robust JSON parsing. Always `exit 0` from hooks to avoid blocking Claude.
**Warning signs:** Hook errors in Claude Code transcript.

### Pitfall 6: ESLint Config File Must Be .mjs for ESM Projects
**What goes wrong:** `eslint.config.js` fails in a project with `"type": "module"`.
**Why it happens:** ESLint 10 starts looking from the linted file's directory for config. The project uses `"type": "module"` in package.json, so `.js` files are ESM. While this should work, using `.mjs` is explicit and avoids confusion.
**How to avoid:** Name the file `eslint.config.mjs` to be explicit about ESM format.
**Warning signs:** Syntax errors about `require` or `import`.

## Code Examples

Verified patterns from official sources:

### Complete eslint.config.mjs
```javascript
// Source: https://typescript-eslint.io/getting-started/
// Source: https://eslint.org/blog/2026/02/eslint-v10.0.0-released/
// Source: https://react.dev/reference/eslint-plugin-react-hooks

// @ts-check
import eslint from '@eslint/js';
import { defineConfig } from 'eslint/config';
import tseslint from 'typescript-eslint';
import eslintConfigPrettier from 'eslint-config-prettier/flat';
import reactHooks from 'eslint-plugin-react-hooks';
import globals from 'globals';
import autoImports from './.wxt/eslint-auto-imports.mjs';

export default defineConfig(
  // Global ignores (replaces .eslintignore)
  {
    ignores: [
      '.output/**',
      '.wxt/**',
      'node_modules/**',
      'public/**',
      '.planning/**',
      'scripts/**',
    ],
  },

  // Base recommended rules
  eslint.configs.recommended,

  // TypeScript rules
  tseslint.configs.recommended,

  // Browser + WebExtension globals
  {
    languageOptions: {
      globals: {
        ...globals.browser,
        ...globals.webextensions,
      },
    },
  },

  // WXT auto-import globals
  autoImports,

  // React Hooks
  reactHooks.configs.flat.recommended,

  // Prettier override (MUST be last)
  eslintConfigPrettier,
);
```

### Complete .prettierrc.json
```json
{
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 100,
  "tabWidth": 2,
  "semi": true,
  "arrowParens": "always",
  "endOfLine": "lf",
  "plugins": ["prettier-plugin-tailwindcss"],
  "tailwindStylesheet": "./src/assets/app.css"
}
```

### Complete .prettierignore
```
node_modules/
.output/
.wxt/
.planning/
package-lock.json
*.md
```

### Claude Code Hook (.claude/settings.json addition)
```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | xargs -I{} sh -c 'npx prettier --write \"{}\" 2>/dev/null; npx eslint --fix \"{}\" 2>/dev/null; exit 0'"
          }
        ]
      }
    ]
  }
}
```

### package.json scripts addition
```json
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --write \"src/**/*.{ts,tsx,css}\" \"entrypoints/**/*.{ts,tsx}\" \"*.{json,mjs,ts}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,css}\" \"entrypoints/**/*.{ts,tsx}\" \"*.{json,mjs,ts}\""
  }
}
```

### wxt.config.ts addition for ESLint auto-imports
```typescript
// Add to existing defineConfig:
imports: {
  eslintrc: {
    enabled: 9,
  },
},
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| `.eslintrc.*` (JSON/YAML/JS) | `eslint.config.mjs` flat config | ESLint 9 (2024), mandatory in ESLint 10 (2026-02-06) | Old files completely ignored |
| `.eslintignore` file | `ignores` array in flat config | ESLint 9/10 | Separate ignore file no longer works |
| `env: { browser: true }` | `globals.browser` from `globals` package | ESLint 9 | Must import globals package |
| `eslint-config-prettier` default import | `eslint-config-prettier/flat` import | Recent | `/flat` suffix adds `name` for config inspector |
| `tailwindConfig` (Prettier plugin) | `tailwindStylesheet` | Tailwind v4 (2025) | v4 stores theme in CSS, not config file |
| Separate `@typescript-eslint/parser` + `@typescript-eslint/eslint-plugin` | Unified `typescript-eslint` package | typescript-eslint v8 | Single import, simpler setup |

**Deprecated/outdated:**
- `.eslintrc.*` files: Completely removed in ESLint 10
- `.eslintignore`: Completely removed in ESLint 10
- `ESLINT_USE_FLAT_CONFIG` env var: Removed in ESLint 10
- `eslint-plugin-prettier`: Discouraged by Prettier team -- run Prettier separately
- `@typescript-eslint/parser` + `@typescript-eslint/eslint-plugin` as separate packages: Use unified `typescript-eslint` package

## Open Questions

1. **Prettier style preferences (singleQuote, printWidth, etc.)**
   - What we know: Prettier is opinionated by design. The existing codebase appears to use single quotes and 2-space indentation based on browsing source files.
   - What's unclear: User may have specific formatting preferences.
   - Recommendation: Use common defaults (singleQuote: true, printWidth: 100, tabWidth: 2) and adjust if user requests changes.

2. **Whether to include `tseslint.configs.strict` instead of `recommended`**
   - What we know: The project uses TypeScript strict mode. `strict` config catches more potential bugs but may require more `eslint-disable` comments.
   - What's unclear: How many warnings/errors `strict` would produce on the existing codebase.
   - Recommendation: Start with `recommended`, run it, then consider upgrading to `strict` if clean.

3. **Whether type-checked linting is worth the performance cost**
   - What we know: `recommended-type-checked` requires full TS program construction, making linting slower. Provides stronger guarantees.
   - What's unclear: Acceptable lint time for 57 files.
   - Recommendation: Start with `recommended` (fast). Type-checked can be added as a follow-up.

## Sources

### Primary (HIGH confidence)
- [ESLint v10.0.0 release blog](https://eslint.org/blog/2026/02/eslint-v10.0.0-released/) - Breaking changes, new features, Node.js requirements
- [typescript-eslint Getting Started](https://typescript-eslint.io/getting-started/) - v8.54.0 flat config setup, recommended packages
- [typescript-eslint Shared Configs](https://typescript-eslint.io/users/configs/) - All available presets and their purposes
- [Claude Code Hooks Guide](https://code.claude.com/docs/en/hooks-guide) - PostToolUse hook format, stdin JSON schema, exit codes
- [eslint-config-prettier GitHub](https://github.com/prettier/eslint-config-prettier) - Flat config import path (`/flat` suffix)
- [WXT Auto-Imports ESLint Config](https://wxt.dev/guide/essentials/config/auto-imports) - `eslintrc.enabled: 9` config, generated file paths
- [WXT Eslintrc Interface](https://wxt.dev/api/reference/wxt/interfaces/eslintrc) - API for ESLint integration
- [eslint-plugin-react-hooks npm](https://www.npmjs.com/package/eslint-plugin-react-hooks) - v7.0.1, flat config support via `reactHooks.configs.flat.recommended`
- [prettier-plugin-tailwindcss GitHub](https://github.com/tailwindlabs/prettier-plugin-tailwindcss) - `tailwindStylesheet` option for Tailwind v4

### Secondary (MEDIUM confidence)
- [ESLint Configuration Files docs](https://eslint.org/docs/latest/use/configure/configuration-files) - defineConfig, flat config details
- [ESLint flat config extends blog](https://eslint.org/blog/2025/03/flat-config-extends-define-config-global-ignores/) - defineConfig features
- [globals npm package](https://www.npmjs.com/package/globals) - v17.3.0, webextensions key availability

### Tertiary (LOW confidence)
- None - all findings verified with primary or secondary sources

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - All packages verified via official docs and npm
- Architecture: HIGH - Flat config is the only option in ESLint 10, patterns from official docs
- Pitfalls: HIGH - Based on official release notes and verified breaking changes
- Claude Code hooks: HIGH - Verified from official Claude Code documentation

**Research date:** 2026-02-09
**Valid until:** 2026-03-09 (30 days - stable ecosystem, ESLint 10 just released)
