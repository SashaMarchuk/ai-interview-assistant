---
phase: 07-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - entrypoints/popup/App.tsx
  - src/overlay/HealthIndicator.tsx
  - src/overlay/Overlay.tsx
  - src/overlay/index.ts
autonomous: true

must_haves:
  truths:
    - "User can start capture without ElevenLabs key and sees warning"
    - "User sees health indicator when services have issues"
    - "User sees 'Configure API keys' prompt when both keys missing"
    - "Health indicator is NOT visible when everything is working"
  artifacts:
    - path: "src/overlay/HealthIndicator.tsx"
      provides: "Conditional health status component"
      min_lines: 40
    - path: "entrypoints/popup/App.tsx"
      provides: "Graceful degradation with warnings"
      contains: "Missing ElevenLabs|Missing OpenRouter"
  key_links:
    - from: "src/overlay/Overlay.tsx"
      to: "src/overlay/HealthIndicator.tsx"
      via: "Component import and render"
      pattern: "HealthIndicator"
    - from: "src/overlay/Overlay.tsx"
      to: "src/store"
      via: "useStore subscription for API keys check"
      pattern: "useStore.*apiKeys"
---

<objective>
Add graceful degradation UI and health indicator to the overlay.

Purpose: Per CONTEXT.md decisions, the extension should work partially even if some services are unavailable. Users should always know what's happening (reconnecting, retrying, missing config). Health indicator should only be visible when there are issues.

Output: HealthIndicator component, enhanced popup with warnings, overlay with setup prompt for missing keys
</objective>

<execution_context>
@/Users/sasha-marchuk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sasha-marchuk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-integration/07-CONTEXT.md
@.planning/phases/07-integration/07-RESEARCH.md
@src/overlay/Overlay.tsx
@entrypoints/popup/App.tsx
@src/store/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HealthIndicator component for service status</name>
  <files>src/overlay/HealthIndicator.tsx, src/overlay/index.ts</files>
  <action>
Create a new HealthIndicator component that displays service health issues:

1. Create `src/overlay/HealthIndicator.tsx`:
   - Props: `{ issues: HealthIssue[] }` where HealthIssue is `{ service: string; status: 'warning' | 'error' | 'reconnecting'; message: string }`
   - ONLY render if issues array is not empty (per CONTEXT.md: "only visible when there are issues")
   - Position: Small bar at very top of overlay (above CaptureIndicator)
   - Styling:
     - warning: yellow background, yellow text
     - error: red background, red text
     - reconnecting: blue background with pulse animation
   - Show compact format: "STT: Reconnecting..." or "LLM: Error - check API key"
   - Multiple issues stack vertically

2. Update `src/overlay/index.ts` to export HealthIndicator

Follow existing overlay component patterns (see CaptureIndicator.tsx for reference).
Do NOT show when everything is working - the component returns null if no issues.
  </action>
  <verify>
File exists: `ls src/overlay/HealthIndicator.tsx`
Export exists: `grep -q "HealthIndicator" src/overlay/index.ts`
Returns null when empty: `grep -q "issues.length === 0" src/overlay/HealthIndicator.tsx || grep -q "!issues.length" src/overlay/HealthIndicator.tsx`
  </verify>
  <done>HealthIndicator component created with conditional rendering (only shows when issues exist)</done>
</task>

<task type="auto">
  <name>Task 2: Add setup prompt and health indicator to Overlay</name>
  <files>src/overlay/Overlay.tsx</files>
  <action>
Modify Overlay.tsx to:

1. Import HealthIndicator component

2. Add useStore subscription for API keys:
   ```typescript
   const apiKeys = useStore((state) => state.apiKeys);
   ```

3. Add state for health issues:
   ```typescript
   const [healthIssues, setHealthIssues] = useState<HealthIssue[]>([]);
   ```

4. Create HealthIssue type (or import if added to types):
   ```typescript
   type HealthIssue = {
     service: string;
     status: 'warning' | 'error' | 'reconnecting';
     message: string
   };
   ```

5. Add useEffect to check for missing API keys and build issues array:
   - If both apiKeys.elevenLabs and apiKeys.openRouter are missing: show "Configure API keys in popup"
   - These are static checks, not real-time service status (that comes in plan 02)

6. Render HealthIndicator above CaptureIndicator:
   ```tsx
   <HealthIndicator issues={healthIssues} />
   <CaptureIndicator captureState={captureState} />
   ```

7. When BOTH API keys are missing, show a setup prompt overlay:
   - Centered message: "Configure API keys in Settings to use AI features"
   - Semi-transparent overlay on top of transcript/response panels
   - Don't block the minimize button or drag handle
   - Only show when BOTH keys missing (partial functionality is OK per CONTEXT.md)

Keep existing functionality intact. The setup prompt is ONLY for when BOTH keys are missing.
  </action>
  <verify>
Check imports: `grep -q "HealthIndicator" src/overlay/Overlay.tsx`
Check apiKeys subscription: `grep -q "apiKeys" src/overlay/Overlay.tsx`
Check healthIssues state: `grep -q "healthIssues" src/overlay/Overlay.tsx`
Run build: `cd /Users/sasha-marchuk/Work/Ai-Interview-Assistant-Chrome-Extension && npm run build`
  </verify>
  <done>Overlay shows HealthIndicator and setup prompt when both API keys missing</done>
</task>

<task type="auto">
  <name>Task 3: Enhance popup with graceful degradation warnings</name>
  <files>entrypoints/popup/App.tsx</files>
  <action>
Modify App.tsx to add warning displays for missing API keys:

1. Add warnings section in Capture tab (after Audio Capture section, before Transcription section):
   - Yellow warning box for missing ElevenLabs: "Missing ElevenLabs API key - transcription unavailable"
   - Yellow warning box for missing OpenRouter: "Missing OpenRouter API key - AI responses unavailable"
   - Each warning has a "Configure" link that switches to Settings tab

2. Modify handleStartCapture to allow start WITHOUT API keys:
   - Currently it proceeds regardless of API keys (keep this)
   - Add console.warn if keys missing but don't block

3. Modify handleStartTranscription:
   - Already checks for ElevenLabs key (keep this)
   - Show clearer error with link to settings

Per CONTEXT.md:
- "Missing ElevenLabs API key: Allow start without STT, show warning"
- "Missing OpenRouter API key: Allow start without LLM (transcription only)"

The warnings are informational, NOT blocking. User can still start capture.
  </action>
  <verify>
Check warnings exist: `grep -q "Missing ElevenLabs\|Missing OpenRouter" entrypoints/popup/App.tsx`
Run build: `cd /Users/sasha-marchuk/Work/Ai-Interview-Assistant-Chrome-Extension && npm run build`
  </verify>
  <done>Popup shows non-blocking warnings for missing API keys with links to settings</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. HealthIndicator component exists and exports
3. Overlay renders HealthIndicator (only when issues exist)
4. Popup shows warnings when API keys missing
5. User can still start capture without API keys (non-blocking warnings)
</verification>

<success_criteria>
1. HealthIndicator component created with conditional rendering
2. Overlay shows setup prompt ONLY when both API keys missing
3. Popup shows non-blocking warnings for each missing API key
4. Build succeeds with no TypeScript errors
5. Existing functionality preserved (blur level, drag/resize, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/07-integration/07-01-SUMMARY.md`
</output>
